process.env.NODE_ENV = 'test';

const chai = require('chai');

chai.should();
const Mobile = require('../models/Mobile');
const Timeframe = require('../models/Timeframe');
const mobilesService = require('../controllers/mobiles.services')({
  timeService: Timeframe,
  modelService: Mobile, // passing in this model object is allowed b/c we pass in 'options' to our serivce
});

const sinon = require('sinon');
const request = require('request');
const mongoose = require('mongoose');
const _ = require('lodash');

describe.only('mobileService', () => {
  describe('#getAll', () => {
    it('should return a list of data', (done) => {
      mobilesService.getAll()
        .then((result) => {
          _.isArray(result);
          done();
        })
        .catch(done);
    });
  });
  describe('#findExistingRaffle', () => {
    it('should return a list of data', (done) => {
      mobilesService.findExistingRaffle('BRAVE')
        .then((result) => {
          _.isArray(result);
          _.isEqual('BRAVE', result.keyword);
          done();
        })
        .catch(done);
    });
  });
  describe('#generateTimer', () => {
    it('should return a Error Message: Not Enough to Start', (done) => {
      const data = [{ shortcode: '41444',
        keyword: 'BRAVE5',
        type: 'Fundraising',
        transaction_date: '2017-11-12T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        collected_amount: '$0.00',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        gender: null,
        billing_status: 'completed',
        billing_type: 'non-payment',
        donation: '33468533',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }];

      mobilesService.generateTimer(data, 'BRAVE')
        .then((result) => {
          console.log('result', result);
          const error = result[0].message;
          const message = 'Not Enough To Start';
          _.isString(error).should.be.true;
          _.isEqual(error, message).should.be.true;
          done();
        })
        .catch(done);
    });
  });
  describe('#generateTimer', () => {
    it('should return a newTimer', (done) => {
      const data = [{ shortcode: '41444',
        keyword: 'BRAVE3',
        transaction_date: '2017-11-14T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }, { shortcode: '41444',
        keyword: 'BRAVE3',
        transaction_date: '2017-11-14T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }, { shortcode: '41444',
        keyword: 'BRAVE3',
        transaction_date: '2017-11-14T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }, { shortcode: '41444',
        keyword: 'BRAVE3',
        transaction_date: '2017-11-14T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }];

      mobilesService.generateTimer(data, 'BRAVE')
        .then((result) => {
          _.isObject(result).should.be.true;
          done();
        })
        .catch(done);
    });
  });
  describe('#generateTimer', () => {
    it('should return a Error Message: Endtime already set', (done) => {
      const data = [{ shortcode: '41444',
        keyword: 'BRAVE3',
        transaction_date: '2017-11-14T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }, { shortcode: '41444',
        keyword: 'BRAVE3',
        transaction_date: '2017-11-14T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }, { shortcode: '41444',
        keyword: 'BRAVE3',
        transaction_date: '2017-11-14T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }, { shortcode: '41444',
        keyword: 'BRAVE3',
        transaction_date: '2017-11-14T14:00:00.000Z',
        donation_date: '2017-11-10T22:35:00.000Z',
        phone: '12225559999',
        first_name: 'Fian',
        last_name: 'Lian',
        street_address: '8 Street',
        city: 'Ridge',
        state: 'CA',
        zip: '90027',
        email: 'mil@mail.com',
        transaction_id: '2008537',
        account: 'National Trust for Our Wounded',
        account_id: '7585',
        campaign_name: 'BRIDGESTONE ARENA',
        account_plan: 'Paid',
        account_plan_price: '$499.00'
      }];

      mobilesService.generateTimer(data, 'BRAVE')
        .then((result) => {
          const error = result[0].message;
          const message = 'Endtime already set';
          _.isString(error).should.be.true;
          _.isEqual(error, message).should.be.true;
          done();
        })
        .catch(done);
    });
  });
  describe('#addWeightToRaffle', () => {
    it('collected_amount set to $0 Minimum', (done) => {
      const data = [
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          first_name: '14:53',
          last_name: '14:53',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598519',
          transaction_id: '2017704',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.163Z' },
        { _id: '5a0a2729280b84915a0b0c56',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:54:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          first_name: '14:05',
          last_name: '14:05',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598535',
          transaction_id: '2017707',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.164Z' },
        { _id: '5a0a2729280b84915a0b0c57',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:56:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:55:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          first_name: 'John',
          last_name: 'Yu',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598628',
          transaction_id: '2017711',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.164Z ' },
        { _id: '5a0a2729280b84915a0b0c58',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:56:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:56:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          first_name: 'John',
          last_name: 'Yu',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598698',
          transaction_id: '2017712',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.165Z' }];
      const raffleArr = mobilesService.addWeightToRaffle(data);
      _.isObject(raffleArr).should.be.true;
      _.isEqual(data.length, raffleArr.length).should.be.true;
      _.forEach(raffleArr, (value) => {
        value.should.be.an.instanceOf(Object).and.have.property('keyword');
      });
      done();
    });
  });
  describe('#addWeightToRaffle', () => {
    it('collected_amount set to $0 Minimum with 25 Entries with the same phone/email', (done) => {
      const data = [
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' },
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$0.00',
          phone: '16178204019',
          email: 'john@crs-consulting.com' }];

      const raffleArr = mobilesService.addWeightToRaffle(data);
      _.isObject(raffleArr).should.be.true;
      const maxEntries = 20;
      _.isEqual(maxEntries, raffleArr.length).should.be.true;
      _.forEach(raffleArr, (value) => {
        value.should.be.an.instanceOf(Object).and.have.property('keyword');
      });
      done();
    });
  });
  describe('#addWeightToRaffle', () => {
    it('collected_amount set to $20 Minimum', (done) => {
      const data = [
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$20.00',
          phone: '16178204019',
          first_name: '14:53',
          last_name: '14:53',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598519',
          transaction_id: '2017704',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.163Z' },
        { _id: '5a0a2729280b84915a0b0c56',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:54:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$20.00',
          phone: '16178204019',
          first_name: '14:05',
          last_name: '14:05',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598535',
          transaction_id: '2017707',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.164Z' },
        { _id: '5a0a2729280b84915a0b0c57',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:56:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:55:00 GMT-0800 (PST)',
          collected_amount: '$20.00',
          phone: '16178204019',
          first_name: 'John',
          last_name: 'Yu',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598628',
          transaction_id: '2017711',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.164Z ' },
        { _id: '5a0a2729280b84915a0b0c58',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:56:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:56:00 GMT-0800 (PST)',
          collected_amount: '$20.00',
          phone: '16178204019',
          first_name: 'John',
          last_name: 'Yu',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598698',
          transaction_id: '2017712',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.165Z' }];
      const raffleArr = mobilesService.addWeightToRaffle(data);
      _.isObject(raffleArr).should.be.true;
      _.forEach(raffleArr, (value) => {
        value.should.be.an.instanceOf(Object).and.have.property('keyword');
      });
      done();
    });
  });
  describe('#addWeightToRaffle', () => {
    it('collected_amount set to $50 Minimum', (done) => {
      const data = [
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$50.00',
          phone: '16178204019',
          first_name: '14:53',
          last_name: '14:53',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598519',
          transaction_id: '2017704',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.163Z' },
        { _id: '5a0a2729280b84915a0b0c56',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:54:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$50.00',
          phone: '16178204019',
          first_name: '14:05',
          last_name: '14:05',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598535',
          transaction_id: '2017707',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.164Z' },
        { _id: '5a0a2729280b84915a0b0c57',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:56:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:55:00 GMT-0800 (PST)',
          collected_amount: '$50.00',
          phone: '16178204019',
          first_name: 'John',
          last_name: 'Yu',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598628',
          transaction_id: '2017711',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.164Z ' },
        { _id: '5a0a2729280b84915a0b0c58',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:56:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:56:00 GMT-0800 (PST)',
          collected_amount: '$50.00',
          phone: '16178204019',
          first_name: 'John',
          last_name: 'Yu',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598698',
          transaction_id: '2017712',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.165Z' }];
      const raffleArr = mobilesService.addWeightToRaffle(data);
      _.isObject(raffleArr).should.be.true;
      _.forEach(raffleArr, (value) => {
        value.should.be.an.instanceOf(Object).and.have.property('keyword');
      });
      done();
    });
  });
  describe('#addWeightToRaffle', () => {
    it('collected_amount set to $100 Minimum', (done) => {
      const data = [
        { _id: '5a0a2729280b84915a0b0c55',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:53:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$100.00',
          phone: '16178204019',
          first_name: '14:53',
          last_name: '14:53',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598519',
          transaction_id: '2017704',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.163Z' },
        { _id: '5a0a2729280b84915a0b0c56',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:54:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:53:00 GMT-0800 (PST)',
          collected_amount: '$100.00',
          phone: '16178204019',
          first_name: '14:05',
          last_name: '14:05',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598535',
          transaction_id: '2017707',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.164Z' },
        { _id: '5a0a2729280b84915a0b0c57',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:56:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:55:00 GMT-0800 (PST)',
          collected_amount: '$100.00',
          phone: '16178204019',
          first_name: 'John',
          last_name: 'Yu',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598628',
          transaction_id: '2017711',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.164Z ' },
        { _id: '5a0a2729280b84915a0b0c58',
          shortcode: '41444',
          keyword: 'BRAVE3',
          type: 'Fundraising',
          transaction_date: '2017-11-13T22:56:00.000Z',
          donation_date: 'Mon Nov 13 2017 14:56:00 GMT-0800 (PST)',
          collected_amount: '$100.00',
          phone: '16178204019',
          first_name: 'John',
          last_name: 'Yu',
          street_address: '!9-08rerewfndslkfdklsnfklsdnfklsdflkndslkfn',
          city: 'doisuhfodsbnfosfndslf',
          state: 'CA',
          zip: '90007',
          email: 'john@crs-consulting.com',
          billing_status: 'completed',
          billing_type: 'non-payment',
          donation: '33598698',
          transaction_id: '2017712',
          source: 'non_pay',
          form: 'No Purchase Necessary (General)',
          form_payment_type: 'non-payment',
          form_name: 'No Purchase Necessary',
          form_type: 'general',
          form_id: '64497',
          fulfillment_calls: '0',
          fulfillment_texts: '0',
          donation_notes: '',
          account: 'National Trust for Our Wounded',
          account_id: '7585',
          campaign_name: 'BRIDGESTONE ARENA',
          account_plan: 'Paid',
          account_plan_price: '$499.00',
          frequency: 'One Time',
          anonymous: 'No',
          createdAt: '2017-11-21T21:10:47.165Z' }];
      const raffleArr = mobilesService.addWeightToRaffle(data);
      _.isObject(raffleArr).should.be.true;
      _.forEach(raffleArr, (value) => {
        value.should.be.an.instanceOf(Object).and.have.property('keyword');
      });
      done();
    });
  });
});
